# Storage Architecture Analysis: RustDB vs PostgreSQL

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RustDB (v1.4.1)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:
```
data/
‚îú‚îÄ‚îÄ server_instance.db     # –û–¥–∏–Ω —Ñ–∞–π–ª —Å–æ –í–°–ï–ú–ò –¥–∞–Ω–Ω—ã–º–∏ (bincode)
‚îî‚îÄ‚îÄ wal/
    ‚îú‚îÄ‚îÄ 000000006927f725.wal
    ‚îî‚îÄ‚îÄ 000000006927f771.wal
```

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

#### 1. **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –û–¥–∏–Ω –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª**
```rust
// src/storage/disk.rs:31-36
fn save_snapshot(&self, instance: &ServerInstance) -> Result<(), DatabaseError> {
    let instance_path = self.data_dir.join("server_instance.db");
    let encoded = bincode::serialize(instance)  // –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –í–°–Å
        .map_err(|e| DatabaseError::BinarySerialization(e.to_string()))?;
    fs::write(instance_path, encoded)?;  // –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –í–ï–°–¨ —Ñ–∞–π–ª
    Ok(())
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü—Ä–∏ checkpoint (–∫–∞–∂–¥—ã–µ 100 –æ–ø–µ—Ä–∞—Ü–∏–π) —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è **–≤–µ—Å—å ServerInstance**
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è **–≤–µ—Å—å —Ñ–∞–π–ª** —Ü–µ–ª–∏–∫–æ–º (–¥–∞–∂–µ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞!)
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–∏—Ç–∞–µ—Ç—Å—è **–≤–µ—Å—å —Ñ–∞–π–ª** –≤ –ø–∞–º—è—Ç—å

**Bottleneck:**
- üìà **O(N)** –∑–∞–ø–∏—Å—å –ø—Ä–∏ checkpoint, –≥–¥–µ N = –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- üìà **O(N)** —á—Ç–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- üîí **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ I/O** –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞
- üíæ **RAM = Disk** - –≤—Å—è –ë–î –¥–æ–ª–∂–Ω–∞ –ø–æ–º–µ—â–∞—Ç—å—Å—è –≤ –ø–∞–º—è—Ç—å
- üêå **Scaling limit**: ~10-100 MB –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Ç–æ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ)

#### 2. **WAL –Ω–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π**
```rust
// src/storage/disk.rs:74-80
let logs = self.wal.read_all_logs()?;
for entry in logs {
    if let Some(db) = instance.databases.values_mut().next() {  // ‚ùå –ë–µ—Ä–µ—Ç –ø–µ—Ä–≤—É—é –ø–æ–ø–∞–≤—à—É—é—Å—è –ë–î!
        WalManager::apply_operation(db, &entry.operation)?;
    }
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- WAL –Ω–µ –∑–Ω–∞–µ—Ç –æ multi-database (–ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫ –ø–µ—Ä–≤–æ–π –ø–æ–ø–∞–≤—à–µ–π—Å—è)
- –ù–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É WAL –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏
- –ü—Ä–∏ crash recovery –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –∫ —Ç–æ–π –ë–î

#### 3. **Checkpoint threshold = 100 –æ–ø–µ—Ä–∞—Ü–∏–π**
```rust
snapshot_threshold: 100  // –ö–∞–∂–¥—ã–µ 100 –æ–ø–µ—Ä–∞—Ü–∏–π = –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å!
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (1000 INSERT/sec) ‚Üí 10 full rewrites/sec!
- –° —Ä–æ—Å—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö checkpoint —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å—ë –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- Write amplification: –≤—Å—Ç–∞–≤–∫–∞ 1 —Å—Ç—Ä–æ–∫–∏ ‚Üí –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –≤—Å–µ–π –ë–î

---

## PostgreSQL Architecture (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:
```
$PGDATA/
‚îú‚îÄ‚îÄ base/
‚îÇ   ‚îú‚îÄ‚îÄ 16384/          # Database OID
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 16385       # Table file (1 GB max)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 16385.1     # Continuation file
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 16385_fsm   # Free Space Map
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 16385_vm    # Visibility Map
‚îÇ   ‚îî‚îÄ‚îÄ 16385/          # Another database
‚îú‚îÄ‚îÄ pg_wal/
‚îÇ   ‚îú‚îÄ‚îÄ 000000010000000000000001
‚îÇ   ‚îú‚îÄ‚îÄ 000000010000000000000002
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ global/
    ‚îî‚îÄ‚îÄ pg_control       # Cluster metadata
```

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ PostgreSQL:

#### 1. **Page-based storage (8 KB pages)**
```
–ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ = –Ω–∞–±–æ—Ä 8 KB —Å—Ç—Ä–∞–Ω–∏—Ü
‚îú‚îÄ‚îÄ Page 0: Header + Rows 1-100
‚îú‚îÄ‚îÄ Page 1: Header + Rows 101-200
‚îî‚îÄ‚îÄ ...
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ Granular I/O: —á–∏—Ç–∞–µ–º/–ø–∏—à–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ 8 KB
- ‚úÖ –ú–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –≤ –ø–∞–º—è—Ç–∏ (shared buffers) —Ç–æ–ª—å–∫–æ "–≥–æ—Ä—è—á–∏–µ" —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ —Ç–µ—Ä–∞–±–∞–π—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö

#### 2. **–û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü**
- –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ = –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª (–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ 1 GB)
- INSERT –≤ —Ç–∞–±–ª–∏—Ü—É A –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ —Ç–∞–±–ª–∏—Ü—ã B
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

#### 3. **Write-Ahead Log (WAL) –∫–∞–∫ primary storage**
- WAL —Å–æ–¥–µ—Ä–∂–∏—Ç **–≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- Checkpoint = flush dirty pages –Ω–∞ –¥–∏—Å–∫ (**–Ω–µ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å!**)
- Recovery = replay WAL —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint

#### 4. **Buffer Pool (Shared Buffers)**
```
RAM: [Hot Pages] ‚Üê Cache frequently accessed pages
      ‚Üì
Disk: [All Pages] ‚Üê Write only modified pages
```

- –ë–æ–ª—å—à–∞—è –ë–î –Ω–∞ –¥–∏—Å–∫–µ, —Ç–æ–ª—å–∫–æ "–≥–æ—Ä—è—á–∏–µ" —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ RAM
- Lazy write: —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∏—à—É—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- Checkpoint flushes dirty pages, –Ω–µ –≤—Å—é –ë–î

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è RustDB

### Option 1: **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (Quick Fix)**
**–¶–µ–ª—å:** –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É full rewrites

```rust
// –ò–∑–º–µ–Ω–∏—Ç—å threshold
snapshot_threshold: 10_000  // –ë—ã–ª–æ 100, —Å—Ç–∞–ª–æ 10_000

// –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É –æ—Ç–¥–µ–ª—å–Ω–æ
data/
‚îú‚îÄ‚îÄ db_main/
‚îÇ   ‚îú‚îÄ‚îÄ users.db         # –¢–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞ users
‚îÇ   ‚îú‚îÄ‚îÄ orders.db        # –¢–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞ orders
‚îÇ   ‚îî‚îÄ‚îÄ metadata.db      # Database metadata
‚îî‚îÄ‚îÄ wal/
    ‚îî‚îÄ‚îÄ ...
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ (~100 —Å—Ç—Ä–æ–∫)
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ write amplification –≤ 10-100x
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –í—Å—ë –µ—â—ë –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ checkpoint
- ‚ùå –í—Å—è —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–º–µ—â–∞—Ç—å—Å—è –≤ RAM
- ‚ùå Scaling limit: ~100-500 MB per table

### Option 2: **Page-based storage (Medium Effort)**
**–¶–µ–ª—å:** Granular I/O, partial writes

```rust
// –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
pub struct PagedTable {
    pages: Vec<Page>,  // 8 KB pages
    dirty_pages: HashSet<usize>,  // Modified pages
}

pub struct Page {
    page_id: u64,
    data: [u8; 8192],
    header: PageHeader,
}

// Checkpoint: –ø–∏—à–µ–º —Ç–æ–ª—å–∫–æ dirty pages
fn checkpoint(&mut self) -> Result<(), Error> {
    for page_id in &self.dirty_pages {
        let page = &self.pages[*page_id];
        self.write_page(page_id, page)?;  // –¢–æ–ª—å–∫–æ 8 KB!
    }
    self.dirty_pages.clear();
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**
```
data/
‚îú‚îÄ‚îÄ db_main/
‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page_0000.dat   # 8 KB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page_0001.dat   # 8 KB
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ orders/
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ wal/
```

**–ü–ª—é—Å—ã:**
- ‚úÖ Write amplification: —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ú–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å "–≥–æ—Ä—è—á–∏–µ" —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ RAM
- ‚úÖ Scaling: –ª–µ–≥–∫–æ –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö GB
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è  –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (~1000 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)
- ‚ö†Ô∏è  –ù—É–∂–µ–Ω page cache manager
- ‚ö†Ô∏è  –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è (–Ω—É–∂–µ–Ω VACUUM)

### Option 3: **Hybrid: Per-table files + Append-only** (Easiest to implement)
**–¶–µ–ª—å:** –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

```rust
// –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ = –æ—Ç–¥–µ–ª—å–Ω—ã–π append-only —Ñ–∞–π–ª
data/
‚îú‚îÄ‚îÄ db_main/
‚îÇ   ‚îú‚îÄ‚îÄ users.dat          # Append-only rows
‚îÇ   ‚îú‚îÄ‚îÄ users.index        # Primary key index
‚îÇ   ‚îú‚îÄ‚îÄ orders.dat
‚îÇ   ‚îî‚îÄ‚îÄ orders.index
‚îî‚îÄ‚îÄ wal/
```

**Checkpoint:**
```rust
// –ù–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–æ—Å—Ç–æ append –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ (O(1) write)
fn insert_row(&mut self, row: Row) -> Result<(), Error> {
    let position = self.file.seek(SeekFrom::End(0))?;
    self.file.write_all(&bincode::serialize(&row)?)?;
    self.index.insert(row.id, position);  // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º offset
}

// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ compaction (offline)
fn compact(&mut self) -> Result<(), Error> {
    // –£–¥–∞–ª—è–µ–º deleted rows, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–µ** INSERT/UPDATE (append-only)
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (~300 —Å—Ç—Ä–æ–∫)
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ Scaling: –ª–µ–≥–∫–æ –¥–æ 1-10 GB

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è  –ù—É–∂–µ–Ω –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π compaction
- ‚ö†Ô∏è  –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ—Å–ª–µ UPDATE/DELETE
- ‚ö†Ô∏è  –ò–Ω–¥–µ–∫—Å—ã –Ω—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ

---

## Benchmark —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã

–î–∞–≤–∞–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é —Å–∏—Å—Ç–µ–º—É:

```bash
# Test 1: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç checkpoint?
# –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É —Å 10K —Å—Ç—Ä–æ–∫
time {
    CREATE TABLE test (id SERIAL, data TEXT);
    for i in {1..10000}; do
        INSERT INTO test (data) VALUES ('row_$i');
    done
}

# Test 2: –ö–∞–∫ —Ä–∞—Å—Ç—ë—Ç –≤—Ä–µ–º—è checkpoint —Å —Ä–æ—Å—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö?
ls -lh data/server_instance.db   # –†–∞–∑–º–µ—Ä snapshot —Ñ–∞–π–ª–∞
```

---

## –ú–æ–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (Priority Order)

### üöÄ **Immediate (v1.5.0 - Quick Wins)**
1. **–£–≤–µ–ª–∏—á–∏—Ç—å snapshot_threshold: 100 ‚Üí 10,000**
   - –§–∞–π–ª: `src/storage/disk.rs:26`
   - –≠—Ñ—Ñ–µ–∫—Ç: 100x –º–µ–Ω—å—à–µ full rewrites
   - –í—Ä–µ–º—è: 5 –º–∏–Ω—É—Ç

2. **Per-table snapshot files**
   ```rust
   data/
   ‚îú‚îÄ‚îÄ db_main_metadata.db      # –¢–æ–ª—å–∫–æ —Å—Ö–µ–º–∞ –ë–î
   ‚îú‚îÄ‚îÄ db_main_users.db         # –¢–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞ users
   ‚îî‚îÄ‚îÄ db_main_orders.db        # –¢–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞ orders
   ```
   - –≠—Ñ—Ñ–µ–∫—Ç: Write amplification —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤ N —Ä–∞–∑ (–≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü)
   - –í—Ä–µ–º—è: 2-3 —á–∞—Å–∞

### üìà **Short-term (v1.6.0 - Medium Effort)**
3. **Append-only table files**
   - INSERT = O(1) append (–≤–º–µ—Å—Ç–æ O(N) rewrite)
   - Checkpoint = —Ç–æ–ª—å–∫–æ flush –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
   - –í—Ä–µ–º—è: 1-2 –¥–Ω—è

4. **Fix multi-database WAL**
   - WAL –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ë–î
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π recovery –¥–ª—è multi-database
   - –í—Ä–µ–º—è: 3-4 —á–∞—Å–∞

### üèóÔ∏è  **Long-term (v2.0.0 - Major Rewrite)**
5. **Page-based storage**
   - 8 KB pages –∫–∞–∫ –≤ PostgreSQL
   - Buffer pool manager
   - –¢–æ–ª—å–∫–æ dirty pages –ø–∏—à—É—Ç—Å—è –Ω–∞ –¥–∏—Å–∫
   - –í—Ä–µ–º—è: 1-2 –Ω–µ–¥–µ–ª–∏

---

## –í—ã–≤–æ–¥

**–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ (v1.4.1):**
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –ë–î (<10 MB)
- ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –±—É—Ç—ã–ª–æ—á–Ω–æ–µ –≥–æ—Ä–ª—ã—à–∫–æ**: –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º checkpoint
- ‚ùå –ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–∞–ª—å—à–µ 100 MB –¥–∞–Ω–Ω—ã—Ö

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (v1.5.0):**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **Option 1** (Quick Fix):
1. –£–≤–µ–ª–∏—á–∏—Ç—å threshold –¥–æ 10K
2. Per-table snapshot files
3. –≠—Ç–æ –¥–∞—Å—Ç 10-100x performance boost –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

–•–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å v1.5.0 —Å —ç—Ç–∏–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏? –≠—Ç–æ –∑–∞–π–º—ë—Ç ~3-4 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã.
